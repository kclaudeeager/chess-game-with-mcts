<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCTS Chess Engine</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="connection-status" id="connectionStatus">Connecting...</div>
    
    <div class="game-container">
        <div class="info-panel mcts-info">
            <h3>üß† MCTS Chess Engine</h3>
            <details>
                <summary style="font-size: 1em; cursor: pointer; color: #FFD700; outline: none; margin-bottom: 10px;">Engine & Algorithm Details</summary>
                <div>
                    <p><strong>Algorithm:</strong> Monte Carlo Tree Search</p>
                    <p><strong>Simulations:</strong> ~500 per move</p>
                    <p><strong>Time Limit:</strong> 3 seconds</p>
                    <p><strong>Search Depth:</strong> Variable</p>
                    <h4 style="margin-top: 20px; color: #FFD700;">How MCTS Works:</h4>
                    <p>1. <strong>Selection:</strong> Navigate tree using UCB1</p>
                    <p>2. <strong>Expansion:</strong> Add new nodes</p>
                    <p>3. <strong>Simulation:</strong> Random playouts</p>
                    <p>4. <strong>Backpropagation:</strong> Update statistics</p>
                    <p style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
                        The AI builds a search tree by exploring promising moves and uses random simulations to evaluate positions. Unlike traditional engines, it doesn't rely on deep tactical analysis but rather statistical sampling.
                    </p>
                </div>
            </details>
        </div>
        
        <div class="chess-board-container">
            <div class="info-panel game-info sticky-status" style="margin-bottom: 15px;">
                <div id="gameStatus">
                    <p><strong>Current Player:</strong> <span id="currentPlayer">White</span></p>
                    <p><strong>Check Status:</strong> <span id="checkStatus">None</span></p>
                    <p><strong>Game State:</strong> <span id="gameState">In Progress</span></p>
                </div>
                <h4 style="margin-top: 20px; color: #FFD700;">Material Balance</h4>
                <div id="materialBalance">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div>
                            <strong>White:</strong> <span id="whiteMaterial">39</span> points
                            <div id="whitePieces" style="font-size: 12px; opacity: 0.8;"></div>
                        </div>
                        <div>
                            <strong>Black:</strong> <span id="blackMaterial">39</span> points
                            <div id="blackPieces" style="font-size: 12px; opacity: 0.8;"></div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <strong>Balance:</strong> <span id="materialDifference">Even</span>
                    </div>
                </div>
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p><strong>Instructions:</strong></p>
                    <p>‚Ä¢ Click a piece to select it</p>
                    <p>‚Ä¢ Click a highlighted square to move</p>
                    <p id="gameModeInstructions">‚Ä¢ You play as White, AI as Black</p>
                    <p><strong>Mode:</strong> <span id="currentGameMode">Human vs AI</span></p>
                </div>
                <h4 style="margin-top: 20px; color: #FFD700;">Move History</h4>
                <div class="move-history" id="moveHistory">
                    <p>Game started. White to move.</p>
                </div>
            </div>
            
            <h1>‚ôî MCTS Chess Engine ‚ôõ</h1>
            <div class="status" id="status">Loading game...</div>
            
            <div class="chess-board" id="chessBoard">
                <!-- Board will be generated by JavaScript -->
            </div>
            
            <div class="controls">
                <button onclick="resetGame()" id="resetBtn">üîÑ New Game</button>
                <button onclick="getAIMove()" id="aiMoveBtn" disabled>ü§ñ AI Move</button>
                <select id="gameModeSelect" onchange="changeGameMode()">
                    <option value="human_vs_ai">Human vs AI</option>
                    <option value="human_vs_human">Human vs Human</option>
                </select>
            </div>
            
            <!-- AI Settings Panel -->
            <div id="aiSettings" style="margin-top: 15px; padding: 15px; background-color: #2a2a2a; border-radius: 8px;">
                <h4 style="margin-bottom: 10px; color: #FFD700;">‚öôÔ∏è AI Settings</h4>
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="useRLEngine" onchange="toggleRLEngine()" style="margin: 0;">
                        <span style="font-size: 14px;">üß† Enable RL Enhancement</span>
                    </label>
                    <div style="font-size: 12px; opacity: 0.8; max-width: 300px;">
                        When enabled, the AI uses reinforcement learning to improve its play based on recorded games.
                    </div>
                </div>
                <div id="rlStatus" style="margin-top: 8px; font-size: 12px; opacity: 0.7;"></div>
            </div>
            
            <!-- Player name input for human vs human mode -->
            <div id="playerSetup" style="display: none; margin-top: 15px; padding: 15px; background-color: #2a2a2a; border-radius: 8px;">
                <h4 style="margin-bottom: 10px; color: #FFD700;">üéÆ Player Setup</h4>
                <div style="margin-bottom: 10px;">
                    <label for="playerName" style="display: block; margin-bottom: 5px;">Your Name:</label>
                    <input type="text" id="playerName" placeholder="Enter your name" style="width: 200px; padding: 5px; border-radius: 3px; border: 1px solid #ccc;">
                    <button onclick="setPlayerName()" id="setNameBtn" style="margin-left: 10px; padding: 5px 10px;">Set Name</button>
                </div>
                <div id="playerStatus" style="font-size: 14px; opacity: 0.9;"></div>
            </div>
            
            <!-- Invitation link for human vs human mode -->
            <div id="inviteLink" style="display: none; margin-top: 15px; padding: 15px; background-color: #2a2a2a; border-radius: 8px;">
                <h4 style="margin-bottom: 10px; color: #FFD700;">üîó Invite a Friend</h4>
                <p style="margin-bottom: 10px; font-size: 14px;">Share this link with your friend to join the game:</p>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="inviteUrl" readonly style="flex: 1; padding: 8px; border-radius: 3px; border: 1px solid #ccc; font-family: monospace; font-size: 12px;">
                    <button onclick="copyInviteLink()" style="padding: 8px 12px; white-space: nowrap;">üìã Copy</button>
                </div>
                <div id="inviteStatus" style="margin-top: 10px; font-size: 14px; opacity: 0.9;"></div>
            </div>
            
            <!-- Join game interface for invited players -->
            <div id="joinGame" style="display: none; margin-top: 15px; padding: 15px; background-color: #2a2a2a; border-radius: 8px;">
                <h4 style="margin-bottom: 10px; color: #FFD700;">üéØ Join Game</h4>
                <p id="joinGameInfo" style="margin-bottom: 10px; font-size: 14px;"></p>
                <div style="margin-bottom: 10px;">
                    <label for="joinPlayerName" style="display: block; margin-bottom: 5px;">Your Name:</label>
                    <input type="text" id="joinPlayerName" placeholder="Enter your name" style="width: 200px; padding: 5px; border-radius: 3px; border: 1px solid #ccc;">
                    <button onclick="joinGameSession()" id="joinGameBtn" style="margin-left: 10px; padding: 5px 10px;">Join Game</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
</body>
</html>